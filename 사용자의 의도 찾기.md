## :woman_technologist: 어떤 태그가 사용자의 의도에 가장 부합할까?

`크리스마스에 듣기 좋은 재즈 플레이리스트`에서 `크리스마스, 듣기좋은, 재즈, 플레이리스트` 태그가 추출되었다고 하자.

각각의 embedding을 그저 더해서 title embedding을 생성해야 할까?

어쩌면 `크리스마스, 재즈`가 가장 중요한 단어(즉 사용자의 의도에 맞는 단어)가 아닐까?

그렇다면 사용자의 의도에 맞는 단어를 어떻게 뽑아낼 수 있을까?



base line 구현을 다 하고난 후에 만난 문제는 <<줏대없는 태그 때문에 이상한 결과가 출력된다!>> 였다.

vocab에 있는 태그를 적절히 잘 찾아내기는 하는데, `듣기좋은` , `노래` , `가끔` 과 같은 태그들이 embedding 방향을 바꾸게 되면서 엉뚱한 결과가 나왔다.

이러한 태그를 직접 찾아 일일이 제거하는 것보다는 규칙을 만들어 걸러내고 싶어졌다.

"어떻게 하면 중요하지 않은 태그를 버릴 수 있을까?"



## 방법 1. 유사하지 않은 태그를 버리자.

#### 가설 : 쓸데 없는 태그는 다른 태그와 유사하지 않을거야

`청량한 여름에 딱인 노래들`을 입력하면 `청량한, 여름, 노래`이 추출된다.

`청량한`과 `여름`은 노래 추출에 의미가 있는 태그들이다. 두 embedding은 아마 적당히 비슷한 방향으로 학습이 되었을 것이다.

그러나 `노래` 태그는 `청량한`과도 유사하지 않고 `여름`과도 유사하지 않다. 즉 현재 query에서 그리 중요한 태그가 아니다.

<br></br>

위 가설에 따라, noise인 `노래`를 거르기 위해 다음 과정을 거친다.

1. 추출된 N개의 태그에서 (N combination 2)개의 쌍을 생성하고 cosine similarity를 계산한다.

   ```python
   > Similarity : ["('청량한', '듣고싶은노래') : 0.1906", "('청량한', '여름') : 0.6600", "('듣고싶은노래', '여름') : 0.1676"]
   ```

2. 유사도가 0.1보다 낮은 태그 쌍을 1차적으로 제거한다.

   * 모두 0.1 이상이므로 제거 없이 잰항한다.

3. 남은 태그쌍을 이용하여 0.3분위수를 계산하고 threshold 이하인 경우에 해당 태그 쌍을 제거한다.

   ```python
   > Threshold : 0.3154 # 0.3분위수 계산
   > Filtered tags : ['청량한', '여름'] # 그 중 threshold를 넘은 태그 쌍
   ```

4. 남은 태그 쌍만을 이용하여 노래 추천에 사용합니다.

   ```python
   > Filtered tags : ['청량한', '여름'] # 그 중 threshold를 넘은 태그 쌍
   > Recommended tags  : ['시원한', '더위', '청량', '여름노래', '해변', '휴가', '시원', '바캉스', '무더위', '청량감']
   ```

```python
    def vote(self, tags, verbose = True):
        if len(tags) <= 2:
            return tags

        pairs = []
        for tag1, tag2 in combinations(tags,2):
            sim = self.w2v_model.wv.similarity(tag1, tag2)
            if sim < 0.1:
                continue
            pairs.append((sim, (tag1, tag2)))

        M,m = max(sim for sim, _ in pairs), min(sim for sim, _ in pairs)
        threshold = m + 0.3*(M-m)

        res = []
        for sim, (tag1, tag2) in pairs:
            if sim < threshold:
                continue
            res.append(tag1)
            res.append(tag2)

        if verbose:
            print('> sims :',pairs)
            print('> threshold :',threshold)
        
        return list(set(res))
```



#### 단점 : 쓸데없는 태그가 더 많은 경우에는 제대로 걸러내지 못한다.









## 방법 2. 줏대없는 태그를 걸러줄 새로운 지표를 정의하자!



